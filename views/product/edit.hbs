<div class="container-fluid">

    <!-- start page title -->
    <div class="row">
        <div class="col-12">
            <div class="page-title-box">
                <h4 class="page-title">Cập nhật thông tin sản phẩm</h4>
            </div>
        </div>
    </div>
    <!-- end page title -->

    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="tab-content">
                        <div class="tab-pane show active" id="input-types-preview">
                            <form method="POST" action="/product/update/" enctype="multipart/form-data" id="updateproduct">
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="mb-3">
                                            <label for="namep" class="form-label">Tên sản phẩm</label>
                                            <input type="text" id="namep" class="form-control" name="Name"
                                                value="{{item.Name}}">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Loại sản phẩm</label>
                                            <select name="idType" id="idType" class="form-select">
                                                {{#each items1}}
                                                <option value="{{this.idType}}">{{this.displayname}}</option>
                                                {{/each}}
                                            </select>
                                        </div>

                                        <div class="mb-3">
                                            <label for="price" class="form-label">Giá</label>
                                            <input class="form-control" id="price" type="number" name="Price"
                                                value="{{item.Price}}">
                                        </div>

                                        <div class="mb-3">
                                            <input type="file" class="custom-file-input" id="imgInp" accept="image/*"
                                                name="productImage">
                                        </div>

                                    </div> <!-- end col -->
                                    <div class="col-lg-6">
                                        <img style="width: 300px; height:300px" id="blah"
                                            src="assets/uploads/{{item.Image}}" alt="your image" />
                                    </div>
                                </div>
                                <input name="id" value="{{item._id}}" style="visibility: hidden;">

                                <button class="btn btn-success" style="float:left;">Lưu thay đổi</button>
                            </form>
                            <!-- end row-->
                        </div> <!-- end preview-->

                    </div> <!-- end tab-content-->
                </div> <!-- end card-body -->
            </div> <!-- end card -->
        </div><!-- end col -->
        <script>
            imgInp.onchange = evt => {
                const [file] = imgInp.files
                if (file) {
                    blah.src = URL.createObjectURL(file)
                }
            }
        </script>
    </div><!-- end row -->
</div>

{{!-- AJAX --}}
<script>
    $('#updateproduct').submit(function (e){
        var isSubmit = false;
        var ajaxCall = $.ajax({
            url : "http://localhost:3000/api/productValidator/{{item._id}}",
            type : "post",
            dataType:"json",
            data : {               
                namep : $('#namep').val(),
                idType : $('#idType').val(),
                price : $('#price').val(),
                imgInp : $('#imgInp').val()
            },
            success : function (result){
                if(result.errors.length == 0){                   
                    isSubmit = true;    
                    return true;         
                }
                alert(result.errors[0].msg);
                isSubmit = false;  
                return false;       
            },
            error: function(xhr, status, error){
                alert("Result: " + status + " " + error + " " + xhr.status + " " + xhr.statusText);
                isSubmit = false;
                return false;
            }
        });
        ajaxCall.done(function(data) {           
            if (isSubmit){
                $('#updateproduct').submit();       
            }
        }); 
        return false;   
    });
</script>